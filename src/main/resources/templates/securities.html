<!DOCTYPE html>
<html>
<head>
    <!--阙魁  交易所品种费率页面-->
    <title>交易所品种费率</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/xadmin.css">
    <link rel="stylesheet" href="../css/theme9.css">
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]-->
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>

    <link rel="stylesheet" href="../lib/layui/css/layui.css">


    <script src="../lib/layui/layui.js"></script>
    <!--工具条-->
    <script type="text/html" id="userToolBar">
        <div style="float:right">
            <button class="layui-btn layui-btn-normal layui-btn layui-btn-sm" lay-event="add"><i
                    class="layui-icon">&#xe654;</i>添加数据
            </button>
            <button class="layui-btn layui-btn-danger layui-btn layui-btn-sm" lay-event="deleteAll"><i
                    class="layui-icon">&#xe640;</i>批量删除
            </button>
        </div>

        <form class="layui-form layui-col-space5">
            <div class="layui-form-item" style="text-align: center;">
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center"> 证券编号</label>
                <div class="layui-input-inline">
                    <input type="number" name="securitiesId" lay-verify="required"
                           autocomplete="off" placeholder="" class="layui-input" id="securitiesId_3">
                </div>
                <!--            证券名称-->
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center"> 证券名称</label>
                <div class="layui-input-inline">
                    <input name="securitiesName" lay-verify="required"
                           autocomplete="off" placeholder="" class="layui-input" id="securitiesName_3">
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center">交易所名称</label>
                <div class="layui-inline layui-show-xs-block">
                    <select name="exchangeName" id="exchangeName_3">
                        <option value="">请选择</option>
                        <option value="1">上交所</option>
                        <option value="2">深交所</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center">债券类型</label>
                <div class="layui-inline layui-show-xs-block">
                    <select name="rateType" id="rateType_3">
                        <option value="">请选择</option>
                        <option value="1">股票</option>
                        <option value="2">债券</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <button class="layui-btn" lay-submit="" lay-event="search" lay-filter="sreach"><i class="layui-icon">&#xe615;</i>搜索
                </button>
            </div>
        </form>
    </script>


    <script type="text/javascript">

        layui.use(['element', 'form', 'table', 'layer', 'laydate'], function () {
            var layer = layui.layer;
            var $ = layui.$;
            var table = layui.table;
            var form = layui.form;
            var formSelects = layui.formSelects;
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });

            //新增提交
            form.on('submit(addsubmit)', function (data) {
                var formData = $('#addform').serialize();
                $.post("/Securities/insertSecurities", formData, function (msg) {
                    if (msg > 0) {
                        table.reload('userTable');
                        layer.closeAll();
                        layer.msg('添加成功', {
                            title: '提示',
                            area: ['200px',
                                '140px'],
                            time: 0,
                            btn: ['知道了']
                        });
                    } else {
                        layer.closeAll();
                        layer.msg('添加失败', {
                            title: '提示',
                            area: ['200px',
                                '140px'],
                            time: 0,
                            btn: ['知道了']
                        });
                    }
                });
                return false;
            });

            //修改提交
            form.on('submit(editsubmit)', function (data) {
                var formData = $('#editform').serialize();
                $.post("/Securities/updateSecurities", formData, function (msg) {
                    if (msg > 0) {
                        table.reload('userTable');
                        layer.closeAll();
                        layer.msg('修改成功', {
                            title: '提示',
                            area: ['200px',
                                '140px'],
                            time: 0,
                            btn: ['知道了']
                        });
                    } else {
                        layer.closeAll();
                        layer.msg('修改失败', {
                            title: '提示',
                            area: ['200px',
                                '140px'],
                            time: 0,
                            btn: ['知道了']
                        });
                    }
                });
                return false;
            });

            //查询
            table.render({
                elem: '#userTable',
                url: '/Securities/selectSecurities',
                toolbar: '#userToolBar',
                defaultToolbar: ['filter', 'exports', 'print'],
                height:'full-170',
                cellMinWidth:60,
                cols: [
                    [
                        {type: "checkbox", width: 50},
                        {field: 'securitiesId', title: '证券编号', sort: true},
                        {field: 'securitiesName', title: '证券名称'},
                        {field: 'securitiesType', title: '证券类型', sort: true,
                            templet:function (item) {
                                if (item.securitiesType=="1"){
                                    return '债券';
                                }else if (item.securitiesType=="2"){
                                    return '股票';
                                }
                            }
                        },
                        {field: 'issueDate', title: '发行日期'},
                        {field: 'delayDate', title: '延迟日期'},
                        {field: 'stockName', title: '股票板块', sort: true},
                        {field: 'exchange', title: '交易所', sort: true,
                            templet:function (item) {
                                if (item.exchange=="1"){
                                    return '上交所';
                                }else if (item.exchange=="2"){
                                    return '深交所';
                                }
                            }
                        },
                        {field: 'securitiesDesc', title: '备注', sort: true},
                        {title: '操作', minWidth: 100, toolbar: '#barDemo', align: "center"}
                    ]
                ],
                limits: [10, 15, 20, 25, 50, 100],
                limit: 15,
                page: true,
                skin: 'line'
            });

            //给工具条的按钮添加事件
            table.on('toolbar(userTable)', function (obj) {
                //获取选中复选框的对象，
                var checkStatus = table.checkStatus(obj.config.id);//得到表格选中行的ID
                switch (obj.event) {
                    case 'add':
                        var index = layer.open({
                            type: 1,
                            title: '添加数据信息',
                            closeBtn: 1,
                            move: false,
                            content: $("#addContent"),
                            btn: []
                        });
                        form.render();
                        //全屏
                        layer.full(index);
                        break;
                    case 'search':
                        alert("搜索");
                        var securitiesIds = $("#securitiesId_3").val();
                        var securitiesNames = $("#securitiesNames_3").val();
                        var securitiesTypes = $("#exchangeName_3").val();
                        var exchanges =  $("#rateType_3").val();
                        //表格的重新加载事件
                        table.reload('userTable', {
                            method: 'post'
                            , where: {
                                'securitiesIds': securitiesIds,
                                'securitiesNames': securitiesNames,
                                'securitiesTypes': securitiesTypes,
                                'exchanges': exchanges
                            }
                            , page: {
                                curr: 1
                            }
                        });
                        break;
                    case 'deleteAll':
                        var data = checkStatus.data;
                        //    layer.alert(JSON.stringify(data));
                        if (data.length == 0) {
                            layer.msg("请至少选择一条数据",)
                        } else {
                            var securitiesIds = [];
                            for (var i = 0; i < data.length; i++) {
                                securitiesIds.push(data[i].securitiesId);
                            }
                            layer.confirm('真的删除行么', {icon: 2}, function (index) {
                                layer.close(index);
                                $.post("/Securities/deleteSecurities2", {securitiesId: securitiesIds.join(',')}, function (msg) {
                                    table.reload('userTable');
                                    layer.msg('删除' + checkStatus.data.length + '条记录', {
                                        title: '提示',
                                        area: ['200px', '140px'],
                                        time: 0,
                                        btn: ['知道了']
                                    });
                                });
                            });
                        }
                        break;
                }
            });
            //给表格编辑，删除按钮添加点击事件
            table.on('tool(userTable)', function (obj) {
                var data = obj.data;//得到删除行整行的数据
                alert(data.securitiesId);
                if (obj.event === 'del') {
                    layer.confirm('真的删除行么', {icon: 2}, function (index) {
                        layer.close(index);
                        $.post("../Securities/deleteSecurities",{securitiesId: data.securitiesId}, function (msg) {
                            table.reload('userTable');
                        });

                    });
                } else if (obj.event === 'edit') {
                    alert(JSON.stringify(data));
                    form.val('editform', $.parseJSON(JSON.stringify(data)));
                    var index = layer.open({
                        type: 1,
                        title: '修改证券信息',
                        closeBtn: 1,
                        move: false,
                        area: ['500px', '400px'],
                        content: $('#editContent')
                    });

                    form.render();
                    layer.full(index);
                };
            })
        });
        function myclose() {
            parent.layer.closeAll();
        }
    </script>
</head>
<body style="overflow: auto; background-color: white;"
      class="layui-view-body layui-content">
<div>
    <!--表格-->
    <table id="userTable" lay-filter="userTable" ></table>
    <!--工具条-->
    <div style="display: none;" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit"><i
                class="layui-icon">&#xe642;</i>编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i
                class="layui-icon">&#xe640;</i>删除</a>

    </div>
</div>
<!--增加的div内容-->
<div id="addContent"
     style="display: none; height: 100%; height: 100%; text-align: center;">
    <form id="addform" lay-filter="addform"
          class="layui-form layui-form-pane"
          style="margin: 30px auto; display: inline-block;">
<!--        证券编号-->
        <div class="layui-form-item" style="text-align: center;">
            <label class="layui-form-label layui-bg-green"> 证券编号</label>
            <div class="layui-input-inline">
                <input type="number" name="securitiesId" lay-verify="required"
                       autocomplete="off" placeholder="" class="layui-input">
            </div>
<!--            证券名称-->
            <label class="layui-form-label layui-bg-green"> 证券名称</label>
            <div class="layui-input-inline">
                <input name="securitiesName" lay-verify="required"
                       autocomplete="off" placeholder="" class="layui-input">
            </div>
        </div>

<!--            证券类型-->
        <div class="layui-form-item" style="text-align: center;">
            <label class="layui-form-label layui-bg-green">证券类型</label>
            <div class="layui-input-inline">
                <select name="securitiesType" id="securitiesType">
                    <option value="0">请选择</option>
                    <option value="1">股票</option>
                    <option value="2">债券</option>
                </select>
            </div>
<!--        股票板块-->
            <label class="layui-form-label layui-bg-green">股票板块</label>
            <div class="layui-input-inline">
                <select name="stockId" id="stockId">
                    <option value="0">请选择</option>
                    <option value="1">上交所</option>
                    <option value="2">深交所</option>
                </select>
            </div>
        </div>

<!--        发行日期-->
        <div class="layui-form-item" style="text-align: center;">
            <label class="layui-form-label layui-bg-green"> 发行日期</label>
            <div class="layui-input-inline">
                <input type="number" name="issueDate" lay-verify="required"
                       autocomplete="off" placeholder="" class="layui-input">
            </div>
<!--        延迟日期-->
            <label class="layui-form-label layui-bg-green">延迟日期</label>
            <div class="layui-input-inline">
                <select name="delayDate" id="delayDate">
                    <option value="0">请选择</option>
                    <option value="T+1">T+1</option>
                    <option value="T+2">T+2</option>
                    <option value="T+3">T+3</option>
                    <option value="T+4">T+4</option>
                </select>
            </div>
        </div>

<!--        交易所-->
        <div class="layui-form-item" style="text-align: center;">
            <label class="layui-form-label layui-bg-green">交易所</label>
            <div class="layui-input-inline">
                <select name="exchange" id="exchange">
                    <option value="0">请选择</option>
                    <option value="1">上交所</option>
                    <option value="2">深交所</option>
                </select>
            </div>
<!--         备注-->
            <label class="layui-form-label layui-bg-green"> 备注</label>
            <div class="layui-input-inline">
                <input name="securitiesDesc" lay-verify="required"
                       autocomplete="off" placeholder="" class="layui-input">
            </div>
        </div>

        <div style="position: absolute; bottom: 0px; left: 45%;">
            <button class="layui-btn" lay-submit="" lay-filter="addsubmit">
                <i class="layui-icon">&#x1005;</i>添加
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>

<!--修改的div内容-->
<div id="editContent"
     style="display: none; height: 100%; height: 100%; text-align: center;">
    <form id="editform" lay-filter="editform"
          class="layui-form layui-form-pane"
          style="margin: 30px auto; display: inline-block;">
    <!--        证券编号-->
    <div class="layui-form-item" style="text-align: center;">
        <label class="layui-form-label layui-bg-green"> 证券编号</label>
        <div class="layui-input-inline">
            <input type="number" name="securitiesId" lay-verify="required"
                   autocomplete="off" placeholder="" class="layui-input">
        </div>
        <!--            证券名称-->
        <label class="layui-form-label layui-bg-green"> 证券名称</label>
        <div class="layui-input-inline">
            <input name="securitiesName" lay-verify="required"
                   autocomplete="off" placeholder="" class="layui-input">
        </div>
    </div>

    <!--            证券类型-->
    <div class="layui-form-item" style="text-align: center;">
        <label class="layui-form-label layui-bg-green">证券类型</label>
        <div class="layui-input-inline">
            <select name="securitiesType" id="securitiesType1">
                <option value="0">请选择</option>
                <option value="1">股票</option>
                <option value="2">债券</option>
            </select>
        </div>
        <!--        股票板块-->
        <label class="layui-form-label layui-bg-green">股票板块</label>
        <div class="layui-input-inline">
            <select name="stockId" id="stockId1">
                <option value="0">请选择</option>
                <option value="1">上交所</option>
                <option value="2">深交所</option>
            </select>
        </div>
    </div>

    <!--        发行日期-->
    <div class="layui-form-item" style="text-align: center;">
        <label class="layui-form-label layui-bg-green"> 发行日期</label>
        <div class="layui-input-inline">
            <input type="number" name="issueDate" lay-verify="required"
                   autocomplete="off" placeholder="" class="layui-input">
        </div>
        <!--        延迟日期-->
        <label class="layui-form-label layui-bg-green">延迟日期</label>
        <div class="layui-input-inline">
            <select name="delayDate" id="delayDate1">
                <option value="0">请选择</option>
                <option value="T+1">T+1</option>
                <option value="T+2">T+2</option>
                <option value="T+3">T+3</option>
                <option value="T+4">T+4</option>
            </select>
        </div>
    </div>

    <!--        交易所-->
    <div class="layui-form-item" style="text-align: center;">
        <label class="layui-form-label layui-bg-green">交易所</label>
        <div class="layui-input-inline">
            <select name="exchange" id="exchange1">
                <option value="0">请选择</option>
                <option value="1">上交所</option>
                <option value="2">深交所</option>
            </select>
        </div>
        <!--         备注-->
        <label class="layui-form-label layui-bg-green"> 备注</label>
        <div class="layui-input-inline">
            <input name="securitiesDesc" lay-verify="required"
                   autocomplete="off" placeholder="" class="layui-input">
        </div>
    </div>
        <div style="position: absolute; bottom: 0px; left: 45%;">
            <button class="layui-btn" lay-submit="" lay-filter="editsubmit">
                <i class="layui-icon">&#x1005;</i>确认修改
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>


</body>
</html>
